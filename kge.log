2023-12-19 10:32:22.685882 Using folder: /data/leishuailong/code/HittER-main/local/experiments/20231219-103222-trmeh-fb15k237-best
2023-12-19 10:32:22.685956 Configuration:
2023-12-19 10:32:22.694885   KvsAll:
2023-12-19 10:32:22.694901     label_smoothing: 0.0
2023-12-19 10:32:22.694909     query_types:
2023-12-19 10:32:22.694915       _po: true
2023-12-19 10:32:22.694922       s_o: false
2023-12-19 10:32:22.694928       sp_: true
2023-12-19 10:32:22.694935   ax_search:
2023-12-19 10:32:22.694941     num_sobol_trials: -1
2023-12-19 10:32:22.694947     num_trials: 10
2023-12-19 10:32:22.694953     parameter_constraints: []
2023-12-19 10:32:22.694960     parameters: []
2023-12-19 10:32:22.694966     sobol_seed: 0
2023-12-19 10:32:22.694972   dataset:
2023-12-19 10:32:22.694982     +++: +++
2023-12-19 10:32:22.694989     files:
2023-12-19 10:32:22.694998       +++: +++
2023-12-19 10:32:22.695004       entity_ids:
2023-12-19 10:32:22.695010         filename: entity_ids.del
2023-12-19 10:32:22.695019         type: map
2023-12-19 10:32:22.695025       entity_strings:
2023-12-19 10:32:22.695034         filename: entity_ids.del
2023-12-19 10:32:22.695040         type: map
2023-12-19 10:32:22.695048       relation_ids:
2023-12-19 10:32:22.695055         filename: relation_ids.del
2023-12-19 10:32:22.695063         type: map
2023-12-19 10:32:22.695069       relation_strings:
2023-12-19 10:32:22.695077         filename: relation_ids.del
2023-12-19 10:32:22.695085         type: map
2023-12-19 10:32:22.695095       test:
2023-12-19 10:32:22.695104         filename: test.del
2023-12-19 10:32:22.695112         type: triples
2023-12-19 10:32:22.695121       train:
2023-12-19 10:32:22.695130         filename: train.del
2023-12-19 10:32:22.695136         type: triples
2023-12-19 10:32:22.695145       valid:
2023-12-19 10:32:22.695151         filename: valid.del
2023-12-19 10:32:22.695157         type: triples
2023-12-19 10:32:22.695165     name: fb15k-237
2023-12-19 10:32:22.695173     num_entities: -1
2023-12-19 10:32:22.695182     num_relations: -1
2023-12-19 10:32:22.695190     pickle: true
2023-12-19 10:32:22.695198   eval:
2023-12-19 10:32:22.695206     batch_size: 1024
2023-12-19 10:32:22.695214     chunk_size: -1
2023-12-19 10:32:22.695222     filter_splits:
2023-12-19 10:32:22.695230     - train
2023-12-19 10:32:22.695239     - valid
2023-12-19 10:32:22.695247     filter_with_test: true
2023-12-19 10:32:22.695255     hits_at_k_s:
2023-12-19 10:32:22.695264     - 1
2023-12-19 10:32:22.695272     - 3
2023-12-19 10:32:22.695280     - 10
2023-12-19 10:32:22.695286     metrics_per:
2023-12-19 10:32:22.695293       argument_frequency: false
2023-12-19 10:32:22.695301       head_and_tail: false
2023-12-19 10:32:22.695310       relation_type: true
2023-12-19 10:32:22.695318     num_workers: 0
2023-12-19 10:32:22.695325     pin_memory: false
2023-12-19 10:32:22.695333     split: valid
2023-12-19 10:32:22.695340     tie_handling: rounded_mean_rank
2023-12-19 10:32:22.695346     trace_level: example
2023-12-19 10:32:22.695354     type: entity_ranking
2023-12-19 10:32:22.695362   grid_search:
2023-12-19 10:32:22.695370     parameters:
2023-12-19 10:32:22.695379       +++: +++
2023-12-19 10:32:22.695387     run: true
2023-12-19 10:32:22.695395   import: trme
2023-12-19 10:32:22.695405   job:
2023-12-19 10:32:22.695413     device: cuda
2023-12-19 10:32:22.695421     multi_gpu: true
2023-12-19 10:32:22.695429     type: train
2023-12-19 10:32:22.695437   lookup_embedder:
2023-12-19 10:32:22.695446     class_name: LookupEmbedder
2023-12-19 10:32:22.695453     dim: 320
2023-12-19 10:32:22.695461     dropout: 0.0
2023-12-19 10:32:22.695471     initialize: normal_
2023-12-19 10:32:22.695479     initialize_args:
2023-12-19 10:32:22.695487       +++: +++
2023-12-19 10:32:22.695495       normal_:
2023-12-19 10:32:22.695503         std: 0.02
2023-12-19 10:32:22.695511     normalize:
2023-12-19 10:32:22.695519       p: -1.0
2023-12-19 10:32:22.695526       with_grad: false
2023-12-19 10:32:22.695534     regularize: lp
2023-12-19 10:32:22.695542     regularize_args:
2023-12-19 10:32:22.695550       +++: +++
2023-12-19 10:32:22.695556       p: 2
2023-12-19 10:32:22.695564       weighted: false
2023-12-19 10:32:22.695570     regularize_weight: 0.0
2023-12-19 10:32:22.695578     round_dim_to: []
2023-12-19 10:32:22.695586     sparse: false
2023-12-19 10:32:22.695594   manual_search:
2023-12-19 10:32:22.695602     configurations: []
2023-12-19 10:32:22.695609     run: true
2023-12-19 10:32:22.695616   model: trme
2023-12-19 10:32:22.695625   negative_sampling:
2023-12-19 10:32:22.695633     chunk_size: -1
2023-12-19 10:32:22.695641     filtering:
2023-12-19 10:32:22.695649       implementation: fast_if_available
2023-12-19 10:32:22.695656       o: false
2023-12-19 10:32:22.695664       p: false
2023-12-19 10:32:22.695672       s: false
2023-12-19 10:32:22.695679       split: ''
2023-12-19 10:32:22.695687     frequency:
2023-12-19 10:32:22.695696       smoothing: 1
2023-12-19 10:32:22.695704     implementation: triple
2023-12-19 10:32:22.695713     num_samples:
2023-12-19 10:32:22.695720       o: -1
2023-12-19 10:32:22.695728       p: 0
2023-12-19 10:32:22.695735       s: 3
2023-12-19 10:32:22.695744     sampling_type: uniform
2023-12-19 10:32:22.695751     shared: false
2023-12-19 10:32:22.695759     with_replacement: true
2023-12-19 10:32:22.695767   random_seed:
2023-12-19 10:32:22.695774     numpy: 333
2023-12-19 10:32:22.695783     python: 333
2023-12-19 10:32:22.695792     torch: 339
2023-12-19 10:32:22.695801   search:
2023-12-19 10:32:22.695807     device_pool: []
2023-12-19 10:32:22.695816     num_workers: 1
2023-12-19 10:32:22.695823     on_error: abort
2023-12-19 10:32:22.695831     type: ax
2023-12-19 10:32:22.695840   train:
2023-12-19 10:32:22.695847     abort_on_nan: true
2023-12-19 10:32:22.695855     auto_correct: true
2023-12-19 10:32:22.695863     batch_size: 512
2023-12-19 10:32:22.695871     checkpoint:
2023-12-19 10:32:22.695879       every: 5
2023-12-19 10:32:22.695887       keep: 3
2023-12-19 10:32:22.695894     filt_loss: false
2023-12-19 10:32:22.695902     loss: kl
2023-12-19 10:32:22.695910     loss_arg: .nan
2023-12-19 10:32:22.695917     lr_scheduler: ''
2023-12-19 10:32:22.695925     lr_scheduler_args:
2023-12-19 10:32:22.695934       +++: +++
2023-12-19 10:32:22.695942     max_epochs: 300
2023-12-19 10:32:22.695949     num_workers: 0
2023-12-19 10:32:22.695957     optimizer: Adamax
2023-12-19 10:32:22.695965     optimizer_args:
2023-12-19 10:32:22.695972       +++: +++
2023-12-19 10:32:22.695981       eps: 1.0e-06
2023-12-19 10:32:22.695988       lr: 0.01
2023-12-19 10:32:22.695996       max_grad_norm: 1.0
2023-12-19 10:32:22.696004       schedule: warmup_linear_xdl
2023-12-19 10:32:22.696014       warmup: 0.1
2023-12-19 10:32:22.696022       weight_decay: 0.01
2023-12-19 10:32:22.696033     pin_memory: false
2023-12-19 10:32:22.696042     split: train
2023-12-19 10:32:22.696050     trace_level: epoch
2023-12-19 10:32:22.696058     type: 1vsAll
2023-12-19 10:32:22.696065     update_freq: 1
2023-12-19 10:32:22.696073     visualize_graph: false
2023-12-19 10:32:22.696082   trme:
2023-12-19 10:32:22.696090     activation: gelu
2023-12-19 10:32:22.696099     add_mlm_loss: false
2023-12-19 10:32:22.696107     attn_dropout: 0.1
2023-12-19 10:32:22.696115     class_name: TrmE
2023-12-19 10:32:22.696123     ctx_dropout: 0.3
2023-12-19 10:32:22.696131     dim: -1
2023-12-19 10:32:22.696139     entity_embedder:
2023-12-19 10:32:22.696146       +++: +++
2023-12-19 10:32:22.696154       type: lookup_embedder
2023-12-19 10:32:22.696163     ff_dim: 1280
2023-12-19 10:32:22.696170     hidden_dropout: 0.1
2023-12-19 10:32:22.696179     initializer_range: 0.02
2023-12-19 10:32:22.696187     max_context_size: 50
2023-12-19 10:32:22.696195     mlm_mask: 1.0
2023-12-19 10:32:22.696203     mlm_replace: 0.3
2023-12-19 10:32:22.696211     nhead: 8
2023-12-19 10:32:22.696219     nlayer: 6
2023-12-19 10:32:22.696228     output_dropout: 0.6
2023-12-19 10:32:22.696236     rel_dropout: 0.0
2023-12-19 10:32:22.696244     relation_embedder:
2023-12-19 10:32:22.696252       +++: +++
2023-12-19 10:32:22.696260       type: lookup_embedder
2023-12-19 10:32:22.696268     self_dropout: 0.5
2023-12-19 10:32:22.696275     similarity: DotProduct
2023-12-19 10:32:22.696283     transformer_impl: huggingface
2023-12-19 10:32:22.696320     use_preln: false
2023-12-19 10:32:22.696328     use_rat: false
2023-12-19 10:32:22.696336   user:
2023-12-19 10:32:22.696346     +++: +++
2023-12-19 10:32:22.696354   valid:
2023-12-19 10:32:22.696362     early_stopping:
2023-12-19 10:32:22.696369       min_threshold:
2023-12-19 10:32:22.696378         epochs: 50
2023-12-19 10:32:22.696386         metric_value: 0.05
2023-12-19 10:32:22.696396       patience: 10
2023-12-19 10:32:22.696404     every: 5
2023-12-19 10:32:22.696412     metric: mean_reciprocal_rank_filtered_with_test
2023-12-19 10:32:22.696419     metric_expr: float("nan")
2023-12-19 10:32:22.696428     split: valid
2023-12-19 10:32:22.696437     trace_level: epoch
2023-12-19 10:32:22.696444   verbose: true
2023-12-19 10:32:22.710542   git commit: 621ee8f
2023-12-19 10:32:22.711881 Loading configuration of dataset fb15k-237...
2023-12-19 10:32:22.730822 Loaded 14541 keys from map entity_ids
2023-12-19 10:32:22.731404 Loaded 237 keys from map relation_ids
2023-12-19 10:32:24.111151 Loaded 272115 train triples
2023-12-19 10:32:24.191293 Loaded 17535 valid triples
2023-12-19 10:32:24.279832 Loaded 20466 test triples
2023-12-19 10:32:25.757585 [3e1a22c2] Set train.optimizer_args.t_total=159600
2023-12-19 10:32:25.820404 [3e1a22c2] Initializing spo training job...
2023-12-19 10:32:25.872633 [3e1a22c2] Starting training...
2023-12-19 10:32:25.872689 [3e1a22c2] Starting epoch 1...
2023-12-19 10:32:27.529555 [3e1a22c2]   Neighbors index finished
2023-12-19 10:32:28.956945 [3e1a22c2] CUDA memory after first batch: allocated=   397,221,888 cached=20,023,607,296 max_allocated=18,973,448,192
2023-12-19 10:38:12.135762 [3e1a22c2]   avg_cost: 18.63562254196968
2023-12-19 10:38:12.135784 [3e1a22c2]   avg_loss: 18.63562254196968
2023-12-19 10:38:12.135791 [3e1a22c2]   avg_penalties: {}
2023-12-19 10:38:12.135798 [3e1a22c2]   avg_penalty: 0.0
2023-12-19 10:38:12.135804 [3e1a22c2]   backward_time: 218.99224185943604
2023-12-19 10:38:12.135811 [3e1a22c2]   batches: 532
2023-12-19 10:38:12.135817 [3e1a22c2]   entry_id: e941793e-c1c0-4d85-ae21-48d2ae6e2d71
2023-12-19 10:38:12.135823 [3e1a22c2]   epoch: 1
2023-12-19 10:38:12.135830 [3e1a22c2]   epoch_time: 346.25890278816223
2023-12-19 10:38:12.135836 [3e1a22c2]   event: epoch_completed
2023-12-19 10:38:12.135843 [3e1a22c2]   forward_time: 103.18790626525879
2023-12-19 10:38:12.135849 [3e1a22c2]   job: train
2023-12-19 10:38:12.135855 [3e1a22c2]   job_id: 3e1a22c2-3ac5-4516-a3af-21e15a13e414
2023-12-19 10:38:12.135862 [3e1a22c2]   lr:
2023-12-19 10:38:12.135869 [3e1a22c2]   - 0.0003333333333333333
2023-12-19 10:38:12.135876 [3e1a22c2]   - 0.0003333333333333333
2023-12-19 10:38:12.135883 [3e1a22c2]   - 0.0003333333333333333
2023-12-19 10:38:12.135889 [3e1a22c2]   num_parameters: 15936640
2023-12-19 10:38:12.135896 [3e1a22c2]   optimizer_time: 23.191569089889526
2023-12-19 10:38:12.135901 [3e1a22c2]   other_time: 0.8668572902679443
2023-12-19 10:38:12.135907 [3e1a22c2]   prepare_time: 0.020328283309936523
2023-12-19 10:38:12.135914 [3e1a22c2]   scope: epoch
2023-12-19 10:38:12.135920 [3e1a22c2]   size: 272115
2023-12-19 10:38:12.135926 [3e1a22c2]   split: train
2023-12-19 10:38:12.135933 [3e1a22c2]   timestamp: 1702953492.133209
2023-12-19 10:38:12.135939 [3e1a22c2]   type: 1vsAll
2023-12-19 10:38:12.136026 [3e1a22c2] Finished epoch 1.
2023-12-19 10:38:12.136102 [3e1a22c2] Saving checkpoint to /data/leishuailong/code/HittER-main/local/experiments/20231219-103222-trmeh-fb15k237-best/checkpoint_00001.pt...
2023-12-19 10:38:12.355393 [3e1a22c2] Starting epoch 2...
2023-12-19 10:38:16.287632 [3e1a22c2] Traceback (most recent call last):
2023-12-19 10:38:16.287652 [3e1a22c2]   File "/data/leishuailong/code/HittER-main/kge/cli.py", line 295, in main
2023-12-19 10:38:16.287655 [3e1a22c2]     job.run()
2023-12-19 10:38:16.287657 [3e1a22c2]   File "/data/leishuailong/code/HittER-main/kge/job/train.py", line 193, in run
2023-12-19 10:38:16.287659 [3e1a22c2]     trace_entry = self.run_epoch()
2023-12-19 10:38:16.287661 [3e1a22c2]   File "/data/leishuailong/code/HittER-main/kge/job/train.py", line 389, in run_epoch
2023-12-19 10:38:16.287664 [3e1a22c2]     self.optimizer.step()
2023-12-19 10:38:16.287666 [3e1a22c2]   File "/home/leishuailong/.conda/envs/hitter/lib/python3.8/site-packages/torch/optim/optimizer.py", line 113, in wrapper
2023-12-19 10:38:16.287669 [3e1a22c2]     return func(*args, **kwargs)
2023-12-19 10:38:16.287671 [3e1a22c2]   File "/data/leishuailong/code/HittER-main/kge/util/bert_optim.py", line 123, in step
2023-12-19 10:38:16.287673 [3e1a22c2]     grad.abs().add_(eps).unsqueeze_(0)
2023-12-19 10:38:16.287675 [3e1a22c2] KeyboardInterrupt
